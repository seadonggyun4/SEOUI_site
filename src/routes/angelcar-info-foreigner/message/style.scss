@use '@/routes/styles/constants/colors' as colors;

.chat-container {
  display: grid;
  grid-template-rows: 1fr auto;
  height: calc(100vh - 200px);
  position: relative;
  gap: 0;

  .messages-area {
    grid-row: 1;
    padding: 1rem;
    overflow-y: auto;
    scroll-behavior: smooth;
    min-height: 0;

    -webkit-overflow-scrolling: touch;

    &::-webkit-scrollbar {
      width: 4px;
    }

    &::-webkit-scrollbar-track {
      background: transparent;
    }

    &::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 2px;
    }
  }

  .chat-input-area {
    grid-row: 2;
    min-height: fit-content;
    background: white;
    border-top: 1px solid #e0e0e0;
    z-index: 10;

    textarea {
      width: 100%;
      border: none;
      line-height: 1.4;
      transition: border-color 0.2s ease;

      &:focus {
        border-top: 1px solid colors.$primary-color;
        box-shadow: none;
      }
    }
  }

  .message {
    animation: fadeInUp 0.3s ease-out;

    &.user {
      text-align: right;

      .message-content {
        background: colors.$primary-color;
        color: white;
        margin-left: 20%;
        border-radius: 18px 18px 4px 18px;
      }
    }

    &.admin {
      text-align: left;

      .message-content {
        background: #f1f1f1;
        color: #333;
        margin-right: 20%;
        border-radius: 18px 18px 18px 4px;
      }
    }
  }

  .message-content {
    display: inline-block;
    padding: 0.5rem 0.8rem;
    margin-bottom: 2rem;
    max-width: 80%;
    word-wrap: break-word;

    p {
      line-height: 1.4;
    }

    .timestamp {
      opacity: 0.7;
      display: block;
      line-height: 2;
    }
  }
}

/* iOS Safari 특별 처리 */
@supports (-webkit-touch-callout: none) {
  .chat-container {
    height: calc(100vh - 120px - env(safe-area-inset-bottom));
    grid-template-rows: 1fr auto;
  }

  .chat-input-area {
    padding-bottom: calc(1rem + env(safe-area-inset-bottom));
  }
}

/* 키보드가 올라올 때의 뷰포트 조정 */
.keyboard-open {
  .chat-container {
    height: calc(100vh - 120px);
    grid-template-rows: 1fr auto;
  }
}

/* 가로 모드 대응 */
@media (orientation: landscape) and (max-height: 500px) {
  .chat-container {
    height: calc(100vh - 80px);

    .messages-area {
      padding: 8px;
    }

    .chat-input-area {
      padding: 8px;

      textarea {
        min-height: 36px;
        max-height: 80px;
      }
    }
  }
}